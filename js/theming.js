const themes = {
    // Dark themes
    dark_hard: {
        // Background
        "bg_dim": { color: "#1E2326", type: "background" },
        "bg0": { color: "#272E33", type: "background" },
        "bg1": { color: "#2E383C", type: "background" },
        "bg2": { color: "#374145", type: "background" },
        "bg3": { color: "#414B50", type: "background" },
        "bg4": { color: "#495156", type: "background" },
        "bg5": { color: "#4F5B58", type: "background" },
        "bg_visual": { color: "#4C3743", type: "background" },
        "bg_red": { color: "#493B40", type: "background" },
        "bg_green": { color: "#3C4841", type: "background" },
        "bg_blue": { color: "#384B55", type: "background" },
        "bg_yellow": { color: "#45443C", type: "background" },
        // Foreground
        "fg": { color: "#D3C6AA", type: "foreground" },
        "red": { color: "#E67E80", type: "foreground" },
        "orange": { color: "#E69875", type: "foreground" },
        "yellow": { color: "#DBBC7F", type: "foreground" },
        "green": { color: "#A7C080", type: "foreground" },
        "aqua": { color: "#83C092", type: "foreground" },
        "blue": { color: "#7FBBB3", type: "foreground" },
        "purple": { color: "#D699B6", type: "foreground" },
        "grey0": { color: "#7A8478", type: "foreground" },
        "grey1": { color: "#859289", type: "foreground" },
        "grey2": { color: "#9DA9A0", type: "foreground" },
        "statusline1": { color: "#A7C080", type: "foreground" },
        "statusline2": { color: "#D3C6AA", type: "foreground" },
        "statusline3": { color: "#E67E80", type: "foreground" },
    },
    dark_medium: {
        // Background
        "bg_dim": { color: "#232A2E", type: "background" },
        "bg0": { color: "#2D353B", type: "background" },
        "bg1": { color: "#343F44", type: "background" },
        "bg2": { color: "#3D484D", type: "background" },
        "bg3": { color: "#475258", type: "background" },
        "bg4": { color: "#4F585E", type: "background" },
        "bg5": { color: "#56635f", type: "background" },
        "bg_visual": { color: "#543A48", type: "background" },
        "bg_red": { color: "#514045", type: "background" },
        "bg_green": { color: "#425047", type: "background" },
        "bg_blue": { color: "#3A515D", type: "background" },
        "bg_yellow": { color: "#4D4C43", type: "background" },
        // Foreground
        "fg": { color: "#D3C6AA", type: "foreground" },
        "red": { color: "#E67E80", type: "foreground" },
        "orange": { color: "#E69875", type: "foreground" },
        "yellow": { color: "#DBBC7F", type: "foreground" },
        "green": { color: "#A7C080", type: "foreground" },
        "aqua": { color: "#83C092", type: "foreground" },
        "blue": { color: "#7FBBB3", type: "foreground" },
        "purple": { color: "#D699B6", type: "foreground" },
        "grey0": { color: "#7A8478", type: "foreground" },
        "grey1": { color: "#859289", type: "foreground" },
        "grey2": { color: "#9DA9A0", type: "foreground" },
        "statusline1": { color: "#A7C080", type: "foreground" },
        "statusline2": { color: "#D3C6AA", type: "foreground" },
        "statusline3": { color: "#E67E80", type: "foreground" },
    },
    dark_soft: {
        // Background
        "bg_dim": { color: "#293136", type: "background" },
        "bg0": { color: "#333C43", type: "background" },
        "bg1": { color: "#3A464C", type: "background" },
        "bg2": { color: "#434F55", type: "background" },
        "bg3": { color: "#4D5960", type: "background" },
        "bg4": { color: "#555F66", type: "background" },
        "bg5": { color: "#5D6B66", type: "background" },
        "bg_visual": { color: "#5C3F4F", type: "background" },
        "bg_red": { color: "#59464C", type: "background" },
        "bg_green": { color: "#48584E", type: "background" },
        "bg_blue": { color: "#3F5865", type: "background" },
        "bg_yellow": { color: "#55544A", type: "background" },
        // Foreground
        "fg": { color: "#D3C6AA", type: "foreground" },
        "red": { color: "#E67E80", type: "foreground" },
        "orange": { color: "#E69875", type: "foreground" },
        "yellow": { color: "#DBBC7F", type: "foreground" },
        "green": { color: "#A7C080", type: "foreground" },
        "aqua": { color: "#83C092", type: "foreground" },
        "blue": { color: "#7FBBB3", type: "foreground" },
        "purple": { color: "#D699B6", type: "foreground" },
        "grey0": { color: "#7A8478", type: "foreground" },
        "grey1": { color: "#859289", type: "foreground" },
        "grey2": { color: "#9DA9A0", type: "foreground" },
        "statusline1": { color: "#A7C080", type: "foreground" },
        "statusline2": { color: "#D3C6AA", type: "foreground" },
        "statusline3": { color: "#E67E80", type: "foreground" },
    },
    // Light themes
    light_hard: {
        // Background
        "bg_dim": { color: "#F2EFDF", type: "background" },
        "bg0": { color: "#FFFBEF", type: "background" },
        "bg1": { color: "#F8F5E4", type: "background" },
        "bg2": { color: "#F2EFDF", type: "background" },
        "bg3": { color: "#EDEADA", type: "background" },
        "bg4": { color: "#E8E5D5", type: "background" },
        "bg5": { color: "#BEC5B2", type: "background" },
        "bg_visual": { color: "#F0F2D4", type: "background" },
        "bg_red": { color: "#FFE7DE", type: "background" },
        "bg_green": { color: "#F3F5D9", type: "background" },
        "bg_blue": { color: "#ECF5ED", type: "background" },
        "bg_yellow": { color: "#FEF2D5", type: "background" },
        // Foreground
        "fg": { color: "#5C6A72", type: "foreground" },
        "red": { color: "#F85552", type: "foreground" },
        "orange": { color: "#F57D26", type: "foreground" },
        "yellow": { color: "#DFA000", type: "foreground" },
        "green": { color: "#8DA101", type: "foreground" },
        "aqua": { color: "#35A77C", type: "foreground" },
        "blue": { color: "#3A94C5", type: "foreground" },
        "purple": { color: "#DF69BA", type: "foreground" },
        "grey0": { color: "#A6B0A0", type: "foreground" },
        "grey1": { color: "#919B84", type: "foreground" },
        "grey2": { color: "#7D8778", type: "foreground" },
        "statusline1": { color: "#8DA101", type: "foreground" },
        "statusline2": { color: "#5C6A72", type: "foreground" },
        "statusline3": { color: "#F85552", type: "foreground" },
    },
    light_medium: {
        // Background
        "bg_dim": { color: "#F6F0E1", type: "background" },
        "bg0": { color: "#FFF9E8", type: "background" },
        "bg1": { color: "#F9F3E4", type: "background" },
        "bg2": { color: "#F4EFDF", type: "background" },
        "bg3": { color: "#EFEBDA", type: "background" },
        "bg4": { color: "#EBE6D5", type: "background" },
        "bg5": { color: "#D2DAC2", type: "background" },
        "bg_visual": { color: "#F0F2D4", type: "background" },
        "bg_red": { color: "#FFE4DD", type: "background" },
        "bg_green": { color: "#F1F4D7", type: "background" },
        "bg_blue": { color: "#EAF4ED", type: "background" },
        "bg_yellow": { color: "#FDF1D4", type: "background" },
        // Foreground
        "fg": { color: "#646A73", type: "foreground" },
        "red": { color: "#F85552", type: "foreground" },
        "orange": { color: "#F57D26", type: "foreground" },
        "yellow": { color: "#DFA000", type: "foreground" },
        "green": { color: "#8DA101", type: "foreground" },
        "aqua": { color: "#35A77C", type: "foreground" },
        "blue": { color: "#3A94C5", type: "foreground" },
        "purple": { color: "#DF69BA", type: "foreground" },
        "grey0": { color: "#A6B0A0", type: "foreground" },
        "grey1": { color: "#919B84", type: "foreground" },
        "grey2": { color: "#7D8778", type: "foreground" },
        "statusline1": { color: "#8DA101", type: "foreground" },
        "statusline2": { color: "#646A73", type: "foreground" },
        "statusline3": { color: "#F85552", type: "foreground" },
    },
    light_soft: {
        // Background
        "bg_dim": { color: "#FAF4E6", type: "background" },
        "bg0": { color: "#FFFAE8", type: "background" },
        "bg1": { color: "#F9F5E5", type: "background" },
        "bg2": { color: "#F4F1E0", type: "background" },
        "bg3": { color: "#F0EDDB", type: "background" },
        "bg4": { color: "#ECE8D6", type: "background" },
        "bg5": { color: "#D8DEBF", type: "background" },
        "bg_visual": { color: "#F0F2D4", type: "background" },
        "bg_red": { color: "#FFE3DD", type: "background" },
        "bg_green": { color: "#F0F3D6", type: "background" },
        "bg_blue": { color: "#E9F3EC", type: "background" },
        "bg_yellow": { color: "#FDF0D4", type: "background" },
        // Foreground
        "fg": { color: "#6C707A", type: "foreground" },
        "red": { color: "#F85552", type: "foreground" },
        "orange": { color: "#F57D26", type: "foreground" },
        "yellow": { color: "#DFA000", type: "foreground" },
        "green": { color: "#8DA101", type: "foreground" },
        "aqua": { color: "#35A77C", type: "foreground" },
        "blue": { color: "#3A94C5", type: "foreground" },
        "purple": { color: "#DF69BA", type: "foreground" },
        "grey0": { color: "#A6B0A0", type: "foreground" },
        "grey1": { color: "#919B84", type: "foreground" },
        "grey2": { color: "#7D8778", type: "foreground" },
        "statusline1": { color: "#8DA101", type: "foreground" },
        "statusline2": { color: "#6C707A", type: "foreground" },
        "statusline3": { color: "#F85552", type: "foreground" },
    },
};


const colorDescriptions = {
        // Background
        "bg_dim": "Dimmed Background",
        "bg0":  "Default Background, Line Numbers Background, Signs Background, Status Line Background (inactive), Tab Line Label (active)", 
        "bg1":  "Cursor Line Background, Color Columns, Closed Folds Background, Status Line Background (active), Tab Line Background", 
        "bg2":  "Popup Menu Background, Floating Window Background, Window Toolbar Background",
        "bg3":  "List Chars, Special Keys, Tab Line Label Background (inactive)",
        "bg4":  "Window Splits Separators, Whitespaces, Breaks",
        "bg5":  "Not currently used", 
        "bg_visual":   "Visual Selection", 
        "bg_red":  "Diff Deleted Line Background, Error Highlights", 
        "bg_green":  "Diff Added Line Background, Hint Highlights", 
        "bg_blue":  "Diff Changed Line Background, Info Highlights",
        "bg_yellow":  "Warning Highlights", 
        // Foreground
        "fg": "Default Foreground, Signs, [Treesitter: Constants, Variables, Function Parameters, Properties, Symbol Identifiers]", 
        "red": "Conditional Keywords, Loop Keywords, Exception Keywords, Inclusion Keywords, Uncategorised Keywords, Diff Deleted Signs, Error Messages, Error Signs", 
        "orange":  "Operator Keywords, Operators, Labels, Storage Classes, Composite Types, Enumerated Types, Tags, Title, Debugging Statements", 
        "yellow":  "Types, Special Characters, Warning Messages, Warning Signs, [Treesitter: Modules, Namespaces]", 
        "green": "Function Names, Method Names, Strings, Characters, Hint Messages, Hint Signs, Search Highlights, [Treesitter: Constructors, Function Calls, Built-In Functions, Macro Functions, String Escapes, Regex Literals, Tag Delimiters, Non-Structured Text]",
        "aqua": "Constants, Macros, [Treesitter: Strings, Characters]", 
        "blue":  "Identifiers, Uncategorised Special Symbols, Diff Changed Text Background, Info Messages, Info Signs, [Treesitter: Fields, Special Punctuation, Math Environments]", 
        "purple": "Booleans, Numbers, Preprocessors, [Treesitter: Built-In Constants, Built-In Variables, Macro-Defined Constants, Attributes/Annotations]", 
        "grey0": "Line Numbers, Fold Columns, Concealed Text, Foreground UI Elements", 
        "grey1": "Comments, Punctuation Delimiters, Closed Folds, Ignored/Disabled, UI Borders, Status Line Text", 
        "grey2": "Cursor Line Number, Tab Line Label (inactive)",
        "statusline1": "Menu Selection Background, Tab Line Label Background (active), Status Line Mode Indicator", 
        "statusline2": "Status Line Mode Indicator", 
        "statusline3":  "Status Line Mode Indicator", 
};

function renderPalette(theme) {

    const backgroundPaletteContainer = document.getElementById("backgroundPalette");
    const foregroundPaletteContainer = document.getElementById("foregroundPalette");

    backgroundPaletteContainer.innerHTML = ''; // Clear previous content
    foregroundPaletteContainer.innerHTML = ''; // Clear previous content

    const colors = themes[theme];

    // Set page background and text colors
    const pageBackgroundColorTitle = "bg0";
    const pageTextColorTitle = "fg";
    document.body.style.backgroundColor = colors[pageBackgroundColorTitle].color;
    document.body.style.color = colors[pageTextColorTitle].color;

    // Set header and footer colors
    const headerFooterColorTitle = "bg_dim";
    document.getElementById("header").style.backgroundColor = colors[headerFooterColorTitle].color;
    document.getElementById("footer").style.backgroundColor = colors[headerFooterColorTitle].color;
    // Set colors of footer links
    var footerAnchors = document.querySelectorAll("footer,a");
    for (let a of footerAnchors) {
        a.style.color = colors[pageTextColorTitle].color;
    }
    
    // Set code editor colors
    document.getElementById("code-editor-container").style.backgroundColor = colors[headerFooterColorTitle].color;
    document.getElementById("codeEditor").style.backgroundColor = colors[headerFooterColorTitle].color;

    // Set theme selector colors
    document.getElementById("theme").style.backgroundColor = colors["bg3"].color;
    document.getElementById("theme").style.color = colors[pageTextColorTitle].color;

    // Set swatches
    for (const [title, { color, description, type }] of Object.entries(colors)) {
        const card = document.createElement("div");
        card.className = "color-card";
        card.style.backgroundColor = color;
        card.style.color = type === "background" ? colors["fg"].color : colors["bg0"].color;
        card.style.cursor = "pointer";

        // Allow the background color to still be visible on its own color by adding a border around it
        if (title === pageBackgroundColorTitle) {
            card.style.borderColor = colors["bg_dim"].color;
            card.style.borderStyle = "solid";
            card.style.borderWidth = "2px";
        }

        const titleDiv = document.createElement("div");
        titleDiv.className = "color-card-title";
        titleDiv.textContent = title;

        const hexCodeDiv = document.createElement("div");
        hexCodeDiv.className = "color-card-hex";
        hexCodeDiv.textContent = color;

        const tooltip = document.createElement("div");
        tooltip.className = "tooltip-text";
        tooltip.textContent = colorDescriptions[title];

        card.appendChild(titleDiv);
        card.appendChild(hexCodeDiv);
        card.appendChild(tooltip);

        // Add click event to copy color to clipboard and show toast message
        card.onclick = function() {
            copyToClipboard(color);
            showToast(`${title} ðŸ“‹ Copied to clipboard!`);
        };

        if (type === "background") {
            backgroundPaletteContainer.appendChild(card);
        } else {
            foregroundPaletteContainer.appendChild(card);
        }
    }

    // Set colors of program cards
    var programs = document.getElementsByClassName("card");
    for (let p of programs) {
        p.style.backgroundColor = colors["bg4"].color;
    }
    
    // var programs = document.querySelectorAll(".card,img");
    // for (let p of programs) {
    //     p.style.fill = colors[pageTextColorTitle].color;
    // }
//    const svgDocument = document.getElementById('jetbrains-icon');
//         const svgElement = svgDocument.contentDocument;
//         svgElement.style.fill = colors[pageTextColorTitle].color; // Change the fill color
//         const paths = svgElement.querySelectorAll('path'); // Select all paths

//     // Change the fill color of all paths
//     paths.forEach(path => {
//         path.style.fill = colors[pageTextColorTitle].color;
//     });
    changeSvgColor("jetbrains-icon",colors[pageTextColorTitle].color );
}

function changeSvgColor(iconId, color) {
    const svgElement = document.getElementById(iconId);
    if (svgElement) {
        const svgDoc = svgElement.contentDocument;
        const svgPaths = svgDoc.querySelectorAll('path');
        svgPaths.forEach(path => {
            path.style.fill = color;
        });
    }
}


function showToast(message) {
    const toast = document.createElement("div");
    toast.className = "toast";
    toast.textContent = message;

    document.body.appendChild(toast);

    setTimeout(() => {
        toast.style.opacity = 0;
    }, 2000); // Toast disappears after 3 seconds

    setTimeout(() => {
        document.body.removeChild(toast);
    }, 3500); // Ensure toast is removed after fade-out
}

// Change theme and re-render palette
function changeTheme() {
    const theme = document.getElementById("theme").value;
    renderPalette(theme);
}

// Initialize palette with default theme
document.addEventListener('DOMContentLoaded', () => {
    changeTheme(); // Initialize palette with default theme
});
